<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="人生如逆旅，我亦是行人。">
<meta property="og:type" content="website">
<meta property="og:title" content="Mx-Don">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mx-Don">
<meta property="og:description" content="人生如逆旅，我亦是行人。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mx-Don">
<meta name="twitter:description" content="人生如逆旅，我亦是行人。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Mx-Don </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Mx-Don</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/02/Learning-Rack/" itemprop="url">
                  Learning Rack
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-02T09:30:15+08:00" content="2016-07-02">
              2016-07-02
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>这几天在看关于rack的知识点，边看边整理。<br>最大的感受就是看技术书会不断地牵扯出新的知识点，不同的人会有不同的理解。 </p>
<p>恍然大悟，生命就该如此。</p>
<h2 id="什么是Rack"><a href="#什么是Rack" class="headerlink" title="什么是Rack?"></a>什么是Rack?</h2><p>我查看wiki：</p>
<blockquote>
<p>Rack provides a modular and adaptable interface for developing web applications in Ruby. By wrapping HTTP requests and responses it unifies the API for web servers, web frameworks, and software in between (the so-called middleware) into a single method call.</p>
</blockquote>
<p>Rack是web server interface，定义了规范。<br>Rack将HTTP requests 和 responses包装好，便于web server 跟 web application之间的调用，一个Rack application可以被任何跟Rack兼容的web server调用。</p>
<ul>
<li>主流的ruby server都支持Rack接口。（WEBrick, Thin, Unicorn …）</li>
<li>主流的ruby web 框架也都支持。(Rails ,Sinatra, Grape …)</li>
</ul>
<h2 id="这是Rack规范。"><a href="#这是Rack规范。" class="headerlink" title="这是Rack规范。"></a>这是Rack规范。</h2><p><a href="http://www.rubydoc.info/github/rack/rack/master/file/SPEC" target="_blank" rel="external">Rack规范书</a><br>内容不多，定义了一些标准。</p>
<h2 id="什么是Rack-Application"><a href="#什么是Rack-Application" class="headerlink" title="什么是Rack Application?"></a>什么是Rack Application?</h2><p>就是符合Rack规范的程序都是，像Rails, Sinatra这些框架写出来的程序都是啦,如果我们想要自己用ruby写一个，也完全可以。</p>
<p>这是一段有内涵的代码，在后面也会反反复复出现很多很多的次。<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myapp</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(env)</span></span></div><div class="line">    [<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span> =&gt; <span class="string">"text/html"</span>&#125;, [<span class="string">"hello world."</span>]]</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">rackapp = Myapp.new</div><div class="line">Rack::Handler::WEBrick.run rackapp, <span class="symbol">:Port</span> =&gt; <span class="number">3000</span></div></pre></td></tr></table></figure></p>
<p>ok,我们已经完成了一个Rack Application了。<br>直接在浏览器访问：<code>http://localhost:3000/</code> ==&gt; <code>&quot;hello world.&quot;</code></p>
<h3 id="如何理解这个过程？"><a href="#如何理解这个过程？" class="headerlink" title="如何理解这个过程？"></a>如何理解这个过程？</h3><p>发送了一个http请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:3000/</div></pre></td></tr></table></figure></p>
<p>返回了这样的响应：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Length: 77</div><div class="line">Content-Type: text/html</div><div class="line">hello world.</div></pre></td></tr></table></figure></p>
<p>Now, say you’re a web server. You have this Rack app loaded in you. And some browser came to you with that request having path ‘/‘. As a server you understand this HTTP request. But you don’t know what to do with it. You have to give it to your Rack app, because it knows very well what to do with such a request.</p>
<p>There is a problem though. Your Rack app does not understand browser requests directly. You need to translate it in a way that he can make sense of it, work with it and then give you a response which you yourself can understand. But the Rack app is kind of a nut-job and doesn’t co-operate easily. So you take the app to a counsellor, to come up with a system.</p>
<p>The counsellor’s name is ‘Rack’. He says, ‘Look Rack app, the server is ready to work together. He’s going to translate the HTTP request in a format that I’ll tell him to. This format will be easy for you to understand. In return, you have to give him a response that he can easily work with. I’ll tell you how your response should look like. Okay?’</p>
<blockquote>
<p>Rack is basically a specification of these two things:</p>
<ul>
<li>what the server should send to the app </li>
<li>what the app should return to the server.</li>
</ul>
</blockquote>
<p>That’s it.</p>
<h3 id="需要符合什么标准呢？"><a href="#需要符合什么标准呢？" class="headerlink" title="需要符合什么标准呢？"></a>需要符合什么标准呢？</h3><p>在规范书里面这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">A Rack application is a Ruby object (not a class) that responds to call. It takes exactly one argument, the environment and returns an Array of exactly three values: The status, the headers, and the body.</div></pre></td></tr></table></figure>
<ul>
<li>是一个ruby 对象，不是一个类。</li>
<li>这个对象可以被call调用。</li>
<li>需要接受一个env参数。</li>
<li>需要返回一个数组，包含status + headers + body。</li>
</ul>
<h3 id="what-can-be-call-？"><a href="#what-can-be-call-？" class="headerlink" title="what can be call ？"></a>what can be <code>call</code> ？</h3><p>ruby中，能够响应的call的有几种。  </p>
<ul>
<li>lambda + Proc  </li>
<li>一个类定义了一个叫做call的实例方法。    </li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">lambda &#123;<span class="params">|env|</span> [<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span> =&gt; <span class="string">"text/html"</span>&#125;, [<span class="string">"hello world."</span>]]&#125;</div><div class="line"></div><div class="line"><span class="comment"># or</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myapp</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(env)</span></span></div><div class="line">    [<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span> =&gt; <span class="string">"text/html"</span>&#125;, [<span class="string">"hello world."</span>]]</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="what-is-the-env"><a href="#what-is-the-env" class="headerlink" title="what is the env ?"></a>what is the <code>env</code> ?</h3><p>如果我访问：<code>http://localhost:3000/search?key=redis</code>,得到的env会类似这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">GATEWAY_INTERFACE - CGI/1.1</div><div class="line">HTTP_ACCEPT - text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div><div class="line">HTTP_ACCEPT_ENCODING - gzip, deflate, sdch</div><div class="line">HTTP_ACCEPT_LANGUAGE - zh-CN,zh;q=0.8,en;q=0.6</div><div class="line">HTTP_CONNECTION - keep-alive</div><div class="line">HTTP_HOST - localhost:3000</div><div class="line">HTTP_UPGRADE_INSECURE_REQUESTS - 1</div><div class="line">HTTP_USER_AGENT - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36</div><div class="line">HTTP_VERSION - HTTP/1.1</div><div class="line">PATH_INFO - /search</div><div class="line">QUERY_STRING - key=redis</div><div class="line">REMOTE_ADDR - ::1</div><div class="line">REMOTE_HOST - ::1</div><div class="line">REQUEST_METHOD - GET</div><div class="line">REQUEST_PATH - /search</div><div class="line">REQUEST_URI - http://localhost:3000/search?key=redis</div><div class="line">SCRIPT_NAME -</div><div class="line">SERVER_NAME - localhost</div><div class="line">SERVER_PORT - 3000</div><div class="line">SERVER_PROTOCOL - HTTP/1.1</div><div class="line">SERVER_SOFTWARE - WEBrick/1.3.1 (Ruby/2.3.0/2015-12-25)</div><div class="line">rack.errors - #&lt;IO:0x007fb9b309eb28&gt;</div><div class="line">rack.hijack - #&lt;Proc:0x007fb9b247fae0@/Users/Don/.rvm/gems/ruby-2.3.0/gems/rack-1.6.4/lib/rack/handler/webrick.rb:76 (lambda)&gt;</div><div class="line">rack.hijack? - true</div><div class="line">rack.hijack_io -</div><div class="line">rack.input - #&lt;StringIO:0x007fb9b247fc20&gt;</div><div class="line">rack.multiprocess - false</div><div class="line">rack.multithread - true</div><div class="line">rack.run_once - false</div><div class="line">rack.url_scheme - http</div><div class="line">rack.version - [1, 3]</div></pre></td></tr></table></figure>
<p>server调用Rack将env传给了app.<br>app是根据这个env来处理用户的请求的，返回对应的响应。env的rack参数规格书里面有说明。</p>
<p>如：会根据<code>PATH_INFO</code>来map路由。</p>
<h3 id="what-is-the-status"><a href="#what-is-the-status" class="headerlink" title="what is the status ?"></a>what is the <code>status</code> ?</h3><h3 id="what-is-the-headers"><a href="#what-is-the-headers" class="headerlink" title="what is the headers ?"></a>what is the <code>headers</code> ?</h3><h3 id="what-is-the-body"><a href="#what-is-the-body" class="headerlink" title="what is the body ?"></a>what is the <code>body</code> ?</h3><p>body是返回的显示结果。配合headers可以被浏览器渲染成不同的东西。<br>body必须可以被each,一般使用字符串的数组。</p>
<h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><p>Rack提供的处理浏览器发来的请求的接口。可以将格式化所传的env.<br>request = Rack::Request.new(env)</p>
<p>获取URL的查询参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">request.params[:search_key]</div></pre></td></tr></table></figure></p>
<p>获取path:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">request.path_info</div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">rack_app = lambda &#123;<span class="params">|env|</span></div><div class="line">  <span class="comment"># 使用Rack的类来进行初始化参数。</span></div><div class="line">  request = Rack::Request.new(env) </div><div class="line">  <span class="keyword">if</span> request.path_info == <span class="string">'/guess'</span></div><div class="line">    <span class="comment"># url?client=xxx</span></div><div class="line">    client = request[<span class="string">"client"</span>]</div><div class="line">    <span class="keyword">if</span> client &amp;&amp; client.downcase == <span class="string">'safari'</span></div><div class="line">      [<span class="number">200</span>, &#123;&#125;, [<span class="string">"yeah, sweet heart!!"</span>]]</div><div class="line">    <span class="keyword">else</span></div><div class="line">      [<span class="number">200</span>, &#123;&#125;, [<span class="string">"please choose another one!!"</span>]]</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">    [<span class="number">200</span>, &#123;&#125;, [<span class="string">"you should choose /guess path!!"</span>]]</div><div class="line">  <span class="keyword">end</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><p>处理返回的结果：</p>
<ul>
<li>直接设置返回结果 response.body, 此时必须自己设置Content-Length的长度。</li>
<li>直接使用response.write, 会自动计算Content-Length的长度。<br>不管用那种方法，最后都调用Response.finish来结束。</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'rack'</span></div><div class="line"></div><div class="line">rack_app = lambda &#123; <span class="params">|env|</span></div><div class="line"></div><div class="line">  request = Rack::Request.new(env)</div><div class="line">  response = Rack::Response.new</div><div class="line"></div><div class="line">  body = <span class="string">"---------header----------&lt;br&gt;"</span></div><div class="line">  <span class="keyword">if</span> request.path_info == <span class="string">"/hello"</span> <span class="comment"># 路由</span></div><div class="line"></div><div class="line">    body &lt;&lt; <span class="string">" you say hello &lt;br&gt;"</span></div><div class="line">    body &lt;&lt; <span class="string">"from <span class="subst">#&#123;client&#125;</span> &lt;br&gt;"</span> <span class="keyword">if</span> client = request[<span class="string">'client'</span>]</div><div class="line"></div><div class="line">  <span class="keyword">else</span></div><div class="line">    body &lt;&lt; <span class="string">"you need enter something.&lt;br&gt;"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  body &lt;&lt; <span class="string">"---------footer----------&lt;br&gt;"</span></div><div class="line">  body &lt;&lt; <span class="string">"&lt;b&gt;here is bye bye ... &lt;/b&gt;"</span></div><div class="line"></div><div class="line">  response.body = [body]</div><div class="line">  response.header[<span class="string">'Content-Length'</span>] = body.bytesize.to_s</div><div class="line">  response.header[<span class="string">'Content-Type'</span>] = <span class="string">'text/plain'</span></div><div class="line">  response.finish</div><div class="line"></div><div class="line">  <span class="comment"># or</span></div><div class="line">  response.write body</div><div class="line">  response.header[<span class="string">'Content-Type'</span>] = <span class="string">'text/html'</span></div><div class="line"></div><div class="line">  response.finish</div><div class="line">&#125;</div><div class="line"></div><div class="line">Rack::Handler::WEBrick.run rack_app, <span class="symbol">:Port</span> =&gt; <span class="number">3000</span></div></pre></td></tr></table></figure>
<h2 id="中间件-–-middleware"><a href="#中间件-–-middleware" class="headerlink" title="中间件 – middleware"></a>中间件 – middleware</h2><p>中间件可以实现业务逻辑与通用逻辑的分离。而这些通用逻辑可以被不同的业务逻辑使用。</p>
<ul>
<li>中间件而已独立发展。</li>
<li>各种中间件可以根据框架需要自由组合。</li>
</ul>
<h3 id="have-a-look"><a href="#have-a-look" class="headerlink" title="have a look"></a>have a look</h3><p>一个简单的Rack程序，比如上面那个，使用两个中间件middleware1 and middleware2。</p>
<p>可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rack::Handler::WEBrick.run Middleware1.new(Middleware2.new(rackapp)), :Port =&gt; 3000</div></pre></td></tr></table></figure>
<p>如果使用很多中间件，那这样会变得很难看。顺序也不容易调整。</p>
<p>我们希望可以看到类似下面的结构：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Builder.new <span class="keyword">do</span> </div><div class="line">    use Middleware1</div><div class="line">    use Middleware2</div><div class="line">    run Rack_App</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这边文章就不单独写代码实现了。在另外一篇文章仔细地写一下如何写出DSL。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/01/Day-Two/" itemprop="url">
                  Day-Two
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-01T19:22:20+08:00" content="2016-07-01">
              2016-07-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>长夜将至，我从今开始守望，至死方休。</p>
<p>我将不娶妻，不封地，不生子。<br>我将不戴宝冠，不争荣宠。<br>我将尽忠职守，生死于斯。</p>
<p>我是黑暗中的利剑，长城上的守卫，抵御寒冷的烈焰，<br>破晓时分的光线，唤醒眠者的号角，守护王国的坚盾。</p>
<p>我将生命与荣耀献给守夜人，今夜如此，夜夜皆然。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/01/Day-One/" itemprop="url">
                  Day-One
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-01T18:30:07+08:00" content="2016-07-01">
              2016-07-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>突然的，又无从下笔。<br>白天看到每一件事都有好多想法，现在回想起来就模模糊糊。</p>
<p><strong>每天晚上这静静的一个小时，我让今天留下了什么？</strong></p>
<h2 id="About-Thinking"><a href="#About-Thinking" class="headerlink" title="About Thinking"></a>About Thinking</h2><blockquote>
<p>讲一种感觉，透彻心扉。<br>那天，欧冠8强第二回合，巴萨输给马竞。在比赛结束哨声响起，一整场期待能够拿下比赛的祈祷，全部落入深渊。<br>一个人坐着，有那么一瞬间，接受不了。仿佛被全世界抛弃。这是我觉得最孤独的一秒钟。但继续生活。</p>
</blockquote>
<hr>
<blockquote>
<p>自己还有很长一段路要走。为了家庭，为了爱人，为了自己。<br>一别都门三改火，天涯踏尽红尘。<br>依然一笑作春温。<br>无波真古井，有节是秋筠。</p>
<p>惆怅孤帆连夜发，送行淡月微云。<br>尊前不用翠眉颦。<br>人生如逆旅，我亦是行人。</p>
</blockquote>
<hr>
<blockquote>
<p>当你不知道干什么的时候，读书或者健身。</p>
</blockquote>
<h2 id="About-Love"><a href="#About-Love" class="headerlink" title="About Love"></a>About Love</h2><p>小娜跟我说过这么一句话：你不是书读的少，是经典的读的少。<br>然后，总是时不时觉得有点慌，一种自己太无知的慌。</p>
<h3 id="休息"><a href="#休息" class="headerlink" title="休息"></a>休息</h3><blockquote>
<p>我家小娜要连续上好几天班，嗯，这个周末也没有放假。最怕最怕的就是她太累。</p>
<p>发信息给她，在睡觉。很是欣慰。<br><strong>当一个人愿意花时间去休息好，才是懂的珍惜时间的。</strong>  </p>
</blockquote>
<h3 id="跑步"><a href="#跑步" class="headerlink" title="跑步"></a>跑步</h3><blockquote>
<p>睡了一会，小娜就去跑步了。加油哦。希望你能爱上跑步的感觉，就如我爱上足球一样。</p>
<p>看来，当成为习惯时，以后要吃什么就去吃什么，不用顾虑了。</p>
</blockquote>
<h3 id="五一"><a href="#五一" class="headerlink" title="五一"></a>五一</h3><blockquote>
<p>我家小娜五一没放假。已经很久没看到你了。放心，五一就去陪你。勿担心。</p>
</blockquote>
<h2 id="About-Friend"><a href="#About-Friend" class="headerlink" title="About Friend"></a>About Friend</h2><h3 id="叼哥帮忙找视频"><a href="#叼哥帮忙找视频" class="headerlink" title="叼哥帮忙找视频"></a>叼哥帮忙找视频</h3><blockquote>
<p>最近想找之前大一新生杯比赛时的点球视频。忘记名字了，找不到。让叼人帮忙找，最后终于找到了。 哇，谢叼哥，欠你个大鸡腿。</p>
<p>闲聊几句，说是每晚加班到12点，甚是辛苦。哎，注意身体。</p>
</blockquote>
<h3 id="小芋头"><a href="#小芋头" class="headerlink" title="小芋头"></a>小芋头</h3><blockquote>
<p>跟小芋头去看了《奇幻森林》。先不写感受。</p>
<p>先讲讲吃的。 看完电影，去吃牛肉火锅。貌似，我很少吃这种东西。 一开始，有点等不及，那种很有食欲的感觉，让我自己都难以相信。</p>
<p>是不是这就是吃货每天的感觉。？如果真的是，我觉得吃货是可以原谅的。</p>
<p>当然，最后还是难以避免的结局，饱到想吐。<br><strong>三餐这么重要，怎可不用心对待！</strong></p>
</blockquote>
<h3 id="龙兄"><a href="#龙兄" class="headerlink" title="龙兄"></a>龙兄</h3><blockquote>
<p>在外奔波了2个月，回到广州。每次带回来都给我带来一大堆特产，这次是新疆的葡萄干。</p>
<p>谢龙兄。</p>
</blockquote>
<h2 id="About-Other"><a href="#About-Other" class="headerlink" title="About Other"></a>About Other</h2><h3 id="大一新生杯视频"><a href="#大一新生杯视频" class="headerlink" title="大一新生杯视频"></a>大一新生杯视频</h3><blockquote>
<p>那时正是大一时。 – 《<a href="http://v.youku.com/v_show/id_XMzI0MzM0Nzg4.html?from=s1.8-1-1.2" target="_blank" rel="external">广工最犀利门神</a>》</p>
</blockquote>
<h3 id="一篇值得思考的文章"><a href="#一篇值得思考的文章" class="headerlink" title="一篇值得思考的文章"></a>一篇值得思考的文章</h3><blockquote>
<p>《<a href="https://mp.weixin.qq.com/s?__biz=MjM5ODgwODY2MA==&amp;mid=2736769554&amp;idx=1&amp;sn=e9239e307e64dc22aca47b95730b050c&amp;scene=1&amp;srcid=0417QuSX25WXES7TpuaHNnRN&amp;key=b28b03434249256b8938cd9c43e23af64d664763efbbe362219e4ae5ce9620bc3fbe89725d70b296f76de022d4626723&amp;ascene=0&amp;uin=MTIyMDM0MTgwNA==&amp;devicetype=iMac%20MacBookPro12,1%20OSX%20OSX%2010.10.4%20build%2814E46%29&amp;version=11020201&amp;pass_ticket=Bhmy2ukQgfaK%2b0g3ddPnmkUJvg4jaACUe5DTTd10Yu1jSQDAUM7KIgDUXZHhoYrz" target="_blank" rel="external">人为什么活着</a>》。<br>很多时候，自己都没去思考，没去想一想，生活生命究竟是什么。<br>总是被每天的琐碎迷惑，摆脱不已。没有真正的思考。</p>
<p>今天提及，日后需要留意。</p>
</blockquote>
<h3 id="拒绝"><a href="#拒绝" class="headerlink" title="拒绝"></a>拒绝</h3><blockquote>
<p>不懂得拒绝的人，即使把自己累死，也不会得到别人真正的尊重。因为在那些习惯麻烦你的人眼里，你帮别人也都帮了，又不是只帮他一个。</p>
<p>这并不是理所当然。</p>
</blockquote>
<h2 id="About-Laugh"><a href="#About-Laugh" class="headerlink" title="About Laugh"></a>About Laugh</h2><blockquote>
<p>三岁女儿：以后我肚子是不是也会有宝宝？<br>爸爸：如果你愿意的话。<br>三岁女儿：不了吧，肚子是留来装糖果的。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/01/My-New-Post/" itemprop="url">
                  在终端配置ssh免密码登录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-01T17:52:21+08:00" content="2016-07-01">
              2016-07-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>总是需要登录服务器部署项目。<br>直接使用Terminal来进行ssh连接，<br>每次都要输入ip + port + name + password 好烦。<br>配置一下实现快速登录。</p>
<h2 id="step-1"><a href="#step-1" class="headerlink" title="step_1"></a>step_1</h2><p>由于可能有多个项目，需要配置一些环境变量。<br>之前都是直接写在<code>~/.bash_profile</code> 或 <code>~/.zshrc</code>。 – – 感觉如果项目一多，会很杂。所以把每个项目的配置抽出来单独一个文件。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 比如，我在Work文件夹中创建了一个名为config的新文件夹。</span></div><div class="line"><span class="comment"># 为每个项目创建一个 xx.sh文件：</span></div><div class="line">ocam.sh</div><div class="line">hive.sh</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 然后在`~/.bash_profile` 或 `~/.zshrc` 里把这些项目的配置文件加进来。</span></div><div class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /Work/config/*.sh; <span class="keyword">do</span></div><div class="line">  source $file;</div><div class="line">done</div><div class="line"></div><div class="line"><span class="comment"># 这样就把每个文件给加进来了。</span></div><div class="line"><span class="comment"># ps:这些配置文件还有个大作用，为每个项目取相应操作的别名。</span></div></pre></td></tr></table></figure>
<h2 id="step-2"><a href="#step-2" class="headerlink" title="step_2"></a>step_2</h2><p>生成公钥/密钥对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">cd ~/.ssh</div><div class="line"></div><div class="line"># C是注释，f是文件名（不同项目使用不同的文件名）</div><div class="line">ssh-keygen -t rsa -C ocam -f ocam_id_rsa </div><div class="line"></div><div class="line"># 指定不同服务器使用不同的公钥/密钥对</div><div class="line"># 在ssh_config中配置。（ssh_config不存在新增即可）</div><div class="line"></div><div class="line">Host 111.22.333.44</div><div class="line">PreferredAuthentications publickey</div><div class="line">IdentityFile ~/.ssh/ocam_id_rsa</div><div class="line">Port 99</div></pre></td></tr></table></figure>
<h2 id="step-3"><a href="#step-3" class="headerlink" title="step_3"></a>step_3</h2><p>将生成的<code>公钥</code>放到服务器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat ~/.ssh/ocam_id_rsa.pub | ssh -t root@111.22.333.44 -p 99 &apos;cat &gt;&gt; .ssh/authorized_keys&apos;</div></pre></td></tr></table></figure>
<h2 id="step-4"><a href="#step-4" class="headerlink" title="step_4"></a>step_4</h2><p>在第一步创建的ocam.sh中,添加进入服务器的命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">alias ocam_test_server=&quot;ssh -t root@111.22.333.44 -p 99&quot;</div><div class="line"></div><div class="line">PS:</div><div class="line">使用简单易记的命令来代替复杂的命令。</div><div class="line">比如：启动redis实例， 启动webpack</div><div class="line">alias ocam_js=&quot;sh Work/ocam/run_script.sh&quot; # webpack</div><div class="line">alias ocam_db=&quot;sh Work/ocam/run_db_script.sh&quot; # 重置数据库</div><div class="line">alias ocam_redis=&quot;sh Work/ocam/run_redis_script.sh&quot; # 启动redis实例</div></pre></td></tr></table></figure></p>
<h2 id="step-5"><a href="#step-5" class="headerlink" title="step_5"></a>step_5</h2><p>以后如果要登录某个项目的服务器，直接打开Terminal, 执行<code>ocam_test_server</code>就可以了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/hexo_avatar.png"
               alt="chenxiaodong" />
          <p class="site-author-name" itemprop="name">chenxiaodong</p>
          <p class="site-description motion-element" itemprop="description">人生如逆旅，我亦是行人。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenxiaodong</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
